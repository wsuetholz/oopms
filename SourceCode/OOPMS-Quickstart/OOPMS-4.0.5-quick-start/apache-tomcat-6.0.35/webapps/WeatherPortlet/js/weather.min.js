var weatherPortlet=weatherPortlet||{};(function(D,C){C.defaults("weatherPortlet.editCities",{saveOrderUrl:null,updateUnitUrl:null,deleteLocationUrl:null,noLocationsMessage:"No Locations Found",searchingMessage:"Searching ...",evenRow:"r1",oddRow:"r2",templateRowClass:"template",cityRowClass:"movable",selectors:{locationRow:".locations table tr.movable",templateRow:".locations table tr.template",orderCell:"td.handle",locationCode:"input[name=code]",selectUnits:".locations table tr.movable select.select-units",deleteLocation:".locations table tr.movable .delete-location-link",addLocationLink:".add-location-link",locationSearch:".location-search",locationList:".locations",locationSearchForm:".locate-search-form",locationSearchMessage:".search-message",cancelSearchLink:".weather-search-form-cancel",searchResults:".search-results",searchResultsForm:".search-results .select-location-form",searchResultsOptions:'.search-results .select-location-form select[name="locationCode"]',searchResultsSelectedOption:'select[name="locationCode"] option:selected'},events:{addCity:null,deleteCity:null}});var F=function(G){G.refreshLocationRows();G.locate("selectUnits").change(function(H){E(G,H,D(this))});G.locate("deleteLocation").click(function(H){B(G,H,D(this))});G.locate("addLocationLink").click(function(){G.locate("locationList").hide();G.locate("locationSearch").show()});G.locate("locationSearchForm").ajaxForm({dataType:"json",beforeSubmit:function(){G.locate("locationSearchMessage").show()},success:function(J){var I=J.locations;if(I.length==0){G.locate("locationSearchMessage").text(G.options.noLocationsMessage)}else{var H=G.locate("searchResultsOptions").html("").get(0);D.each(I,function(L,K){H.options[L]=new Option(K.city+", "+K.stateOrCountry,K.locationCode)});G.locate("locationSearch").hide();G.locate("searchResults").show()}}});G.locate("cancelSearchLink").click(function(){return A(G)});G.locate("searchResultsForm").ajaxForm({dataType:"json",beforeSubmit:function(K,J,I){var H=G.locate("searchResultsSelectedOption",J).text();K[K.length]={name:"location",value:H}},success:function(L){if(L.status!="success"){return }A(G);var I=G.locate("templateRow");var J=I.clone();var K=I.siblings(":last");if(K.size()==0){K=I}K.after(J);J.removeClass(G.options.templateRowClass);J.addClass(G.options.cityRowClass);G.locate("locationCode",J).val(L.location.code);var H=J.find("select.select-units");H.attr("name",H.attr("name")+L.location.code);H.attr("id",H.attr("id")+L.location.code);H.find('option[value="'+L.location.temperatureUnit+'"]').attr("selected","selected");J.find(".location-name").text(L.location.name);J.show();G.events.addCity.fire()}})};weatherPortlet.editCities=function(G,H){var I=C.initView("weatherPortlet.editCities",G,H);I.refreshLocationRows=function(){I.locate("locationRow").each(function(J,K){I.locate("orderCell",K).html((J+1)+".");if(J%2==0){D(K).removeClass(I.options.oddRow).addClass(I.options.evenRow)}else{D(K).removeClass(I.options.evenRow).addClass(I.options.oddRow)}})};I.saveOrder=function(K,L,M){var J=new Array();D.each(M,function(N,O){J[N]=I.locate("locationCode",O).val()});D.post(I.options.saveOrderUrl,{locationCodes:J},function(N){},"json")};F(I);return I};var E=function(I,H,K){var L=K.parents(".locations table tr.movable");var J=I.locate("locationCode",L).val();var G=K.val();D.post(I.options.updateUnitUrl,{locationCode:J,unit:G},function(M){},"json")};var B=function(H,G,J){var K=J.parents(".locations table tr.movable");var I=H.locate("locationCode",K).val();D.post(H.options.deleteLocationUrl,{locationCode:I},function(L){if(L.status=="success"){K.remove();H.events.deleteCity.fire()}else{}},"json")};var A=function(G){G.locate("locationSearch").hide();G.locate("searchResults").hide();G.locate("locationList").show();G.locate("locationSearchForm").clearForm();G.locate("locationSearchMessage").text(G.options.searchingMessage);G.locate("locationSearchMessage").hide();return false}})(jQuery,fluid);if(!weatherPortlet.jQuery){weatherPortlet.jQuery=jQuery.noConflict(true);weatherPortlet.fluid=fluid}else{jQuery.noConflict(true)}fluid=null;