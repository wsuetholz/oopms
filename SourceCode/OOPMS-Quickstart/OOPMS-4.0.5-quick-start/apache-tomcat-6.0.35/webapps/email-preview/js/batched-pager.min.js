var unicon=unicon||{};(function(C,B){var A=function(D){return Math.min(D.totalRange,(D.pageIndex+1)*D.pageSize)};unicon.batchedpager=function(E,G){var I=B.initView("unicon.batchedpager",E,G);var D=function(T,R,O){var P=A(R);var L=R.pageIndex*R.pageSize;if(L<I.state.batchStart||P>(I.state.batchStart+I.options.batchSize)){var N=new Array();if(R.pageSize>I.options.batchSize){I.options.batchSize=R.pageSize}I.state.batchStart=Math.floor(L/I.options.batchSize)*I.options.batchSize;C(I.options.dataFunction(I.state.batchStart,I.options.batchSize,I.state.sortKey,I.state.sortDir)).each(function(){N.push(this)});B.clear(I.pager.options.dataModel);B.model.copyModel(I.pager.options.dataModel,N);I.pager.events.onModelChange.fire(R,I.pager.model,I.pager)}var M=[];var Q=Math.min(P-I.state.batchStart,I.options.batchSize);for(var S=R.pageIndex*R.pageSize-I.state.batchStart;S<Q;++S){var U=O?O[S]:S;M[M.length]={index:U,row:T[U]}}return M};var F=function(M,L){if(L.sortKey==I.state.sortKey&&L.sortDir==I.state.sortDir){return }if(L.sortKey!=I.state.sortKey){L.sortDir=1}I.state.sortKey=L.sortKey;I.state.sortDir=L.sortDir;I.state.batchStart=0;if(L.totalRange<=I.options.batchSize){return B.pager.basicSorter(M,L)}var N=I.options.dataFunction(I.state.batchStart,I.options.batchSize,I.state.sortKey,I.state.sortDir);B.clear(I.pager.options.dataModel);B.model.copyModel(I.pager.options.dataModel,N)};I.refreshView=function(){var M=I.options.dataFunction(0,I.options.batchSize);B.clear(I.pager.options.dataModel);B.model.copyModel(I.pager.options.dataModel,M);var L=B.copy(I.pager.model);L.totalRange=I.options.dataLengthFunction();L.pageIndex=0;L.sortKey=I.state.sortKey;L.sortDir=I.state.sortDir;L.pageCount=Math.max(1,Math.floor((L.totalRange-1)/L.pageSize)+1);B.model.copyModel(I.pager.model,L);I.pager.events.onModelChange.fire(L,I.pager.model,I.pager)};I.state={batchStart:0};var J=I.options.dataFunction(0,I.options.batchSize);var K=G.pagerOptions;K.dataModel=J;K.sorter=F;K.modelFilter=D;I.pager=B.pager(E,K);var H=B.copy(I.pager.model);H.totalRange=I.options.dataLengthFunction();H.pageCount=Math.max(1,Math.floor((H.totalRange-1)/H.pageSize)+1);H.sortKey=I.state.sortKey;H.sortDir=I.state.sortDir;I.pager.events.onModelChange.fire(H,I.pager.model,I.pager);B.model.copyModel(I.pager.model,H);return I};B.defaults("unicon.batchedpager",{batchSize:20,dataFunction:null,dataLengthFunction:null})})(jQuery,fluid);